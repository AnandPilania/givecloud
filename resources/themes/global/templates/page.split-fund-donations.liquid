{% schema %}
[
    {
        "name": "Split Fund Fields",
        "config": {
            "hide_content_editor": true
        },
        "settings": [
            {
                "type": "header",
                "content": "Split Fund Page: Branding"
            },
            {
                "type": "text",
                "name": "subtitle",
                "revisable": true,
                "label": "Sub Title in Header",
                "size":"md"
            },
            {
                "type": "on-off",
                "name": "sharing",
                "label": "Social Sharing"
            },
            {
                "type": "header",
                "content": "Split Fund Page: Items Panel"
            },
            {
                "type": "text",
                "name": "funds_header_text",
                "revisable": true,
                "label": "Funds Header Text",
                "default": "",
                "info": "This allows you to override the header text in the fund selection section.",
                "placeholder": "Which funds would you like to give to?"
            },
            {
                "type": "text",
                "name": "frequency_header_text",
                "revisable": true,
                "label": "Frequency Header Text",
                "default": "",
                "info": "This allows you to override the header text in the payment frequency section.",
                "placeholder": "How often would you like to give?"
            },
            {
                "type": "variant",
                "name": "donations",
                "label": "Donation(s)",
                "default": "",
                "is_donation": true,
                "multiple": true,
                "info": "These are the donations that will be available on this page. Please note that 'one-time' and 'recurring' settings will be overridden on this template."
            },
            {
                "type": "multi",
                "name": "billing_periods",
                "label": "Payments",
                "options": {
                    "onetime": "One-Time",
                    "weekly": "Recurring Weekly",
                    "biweekly": "Recurring Bi-Weekly",
                    "monthly": "Recurring Monthly",
                    "quarterly": "Recurring Quarterly",
                    "biannually": "Recurring Bi-Annually",
                    "annually": "Recurring Annually"
                },
                "size":"md",
                "default":"",
                "info": "Select all the kinds of payments you'd like to allow."
            },
            {
                "type": "on-off",
                "name": "show_variant_name",
                "label": "Show Variant Name",
                "default": false,
                "info": "If this setting is turned on, the variant's name will show next to the product name. If this setting is turned off, the variant name will be hidden."
            },
            {
                "type": "on-off",
                "name": "use_variant_price_presets",
                "label": "Show Variant Price Presets",
                "default": false,
                "info": "If this setting is turned on and you have setup price presets on the chosen variant, it will show the presets on the page. If this setting is turned off, all variants will show an amount field."
            },
            {
                "type": "on-off",
                "name": "pay_page_cover_fees",
                "label": "Cover the Fees",
                "default": true,
                "info": "Enable/disable cover the fees functionality. Will only show if the site-wide setting for DCC is turned on."
            },
            {
                "type": "header",
                "content": "Split Fund Page: Billing"
            },
            {
                "type": "on-off",
                "name": "email_optin_enabled",
                "label": "Enable Email Opt-in",
                "default": true,
                "info": "Enable/Disable the Email Opt-in Field in the Billing Section."
            },
            {
                "type": "on-off",
                "name": "billing_phone_required",
                "label": "Require Billing Phone",
                "default": false,
                "info": "Require the Billing Phone Field."
            },
            {
                "type": "on-off",
                "name": "referral_source_enabled",
                "label": "Enable Referral Source",
                "default": false,
                "info": "Enable/Disable the Referral Source Field in the Billing Section."
            },
            {
                "type": "on-off",
                "name": "pay_page_referral_source_required",
                "label": "Requires a referral source",
                "info": "Should the referral source be required at checkout.",
                "default": true
            },
            {
                "type": "on-off",
                "name": "special_notes_enabled",
                "label": "Enable Special Notes",
                "default": false,
                "info": "Enable/Disable the Special Notes Field."
            },
            {
                "type": "header",
                "content": "Split Fund Page: Optional Content"
            },
            {
                "type": "text",
                "revisable": true,
                "name": "funds_opt_content_heading",
                "label": "Heading"
            },
            {
                "type": "html",
                "revisable": true,
                "name": "funds_opt_content",
                "label": "Content"
            }
        ]
    }
]
{% endschema %}

{% if settings.cart_comments_enabled and page.metadata.special_notes_enabled %}
    {% assign show_special_notes = true %}
{% else %}
    {% assign show_special_notes = false %}
{% endif %}

{% if site.referral_sources.enabled and page.metadata.referral_source_enabled %}
    {% assign show_referral_sources = true %}
{% else %}
    {% assign show_referral_sources = false %}
{% endif %}

{% if site.cover_costs_enabled and page.metadata.pay_page_cover_fees %}
    {% assign show_cover_costs = true %}
{% else %}
    {% assign show_cover_costs = false %}
{% endif %}

{% capture page_title %}
    {{ page.title }}{% if page.metadata.subtitle %}<br><small>{{ page.metadata.subtitle }}</small>{% endif %}
{% endcapture %}

{% asset async: true, ext: js, defer: true, 'https://maps.googleapis.com/maps/api/js?key={google_maps_api_key}&libraries=places&callback=loadLookup' %}

{% include 'header-image', header_title: page_title, header_image: page.feature_image.full %}

<div id="split-fund-donations-app" class="page-content split-fund-donations pb-5" variants="{{ page.metadata.donations | json | escape }}" use-variant-price-presets="{{ page.metadata.use_variant_price_presets }}" billing-periods="{{ page.metadata.billing_periods | json | escape }}" subscription-default-type="{{ site.subscription_default_type | escape  }}" payment-day-options="{{ site.payment_day_options | json | escape  }}" payment-weekday-options="{{ site.payment_weekday_options | json | escape  }}" recurring-first-payment-default="{{ settings.product_recurring_first_payment_default}}" show-cover-costs="{{ show_cover_costs }}" {% if request.input.cover_fees == false %}cover-fees-state="unchecked"{% endif %} v-cloak>
    <form v-show="ready" ref="form" @submit.prevent="submitPayForm" :class="{ 'was-validated': payValidated }" data-vv-scope="pay" method="post" novalidate>

        <div class="container mt-n5">

            <div class="row">
                <div class="col-12">

                    <div v-if="variants && variants.length > 0" class="card my-4 card-shipping {% if settings.animations %}wow fadeIn{% endif %}" {% if settings.animations %}data-wow-delay="1s"{% endif %}>

                        <div class="card-body">
                            <h4 class="text-left d-block mb-3">
                                {% capture funds_header_text -%}
                                    {{ 'templates.page_split_fund_donations.which_funds_would_you_like_to_give_to' | t }}
                                {%- endcapture %}

                                {{ page.metadata.funds_header_text | default: funds_header_text }}
                            </h4>
                            {% if settings.page_headings_decoration == 'none' %}
                                <hr />
                            {% endif %}
                            <div v-for="(variant, index) in variants" :key="variant.id">
                                <hr v-if="index !== 0" />
                                <div class="d-flex flex-column text-center text-md-left flex-md-row w-100 align-items-center justify-content-center justify-content-left {% if settings.animations %}wow fadeInUp{% endif %}" {% if settings.animations %}:data-wow-delay="(index/10) + 's'"{% endif %}>
                                    <div v-if="variant.image" class="fund-thumb my-2 my-md-0" :style="'background-image:url(' + variant.image + ');'"></div>
                                    <div class="flex-1 mx-3 mt-2 mt-md-0 mb-3 mb-md-0">

                                        <h5 class="mb-1"><span v-if="variant.product.name">${ variant.product.name}{% if page.metadata.show_variant_name %} - </span>${ variant.title }{% endif %}</h5>
                                        <p class="mb-1" v-if="variant.product.description">${ variant.product.description }</p>
                                        <small v-if="variant.minimum_price && variant.amount > 0 && variant.amount < variant.minimum_price" class="text-muted d-none d-md-block">
                                            {{ 'templates.page_split_fund_donations.there_is_a_minimum_donation_of' | t: symbol: '${ currencySymbol }', min_price: '${ variant.minimum_price_formatted }' }}
                                        </small>
                                    </div>
                                    <div class="ml-md-auto">
                                        <choose-amount :presets="use_variant_price_presets ? variant.price_presets : []" :currency-code="currency.code" :value="variant.amount" @input="chooseAmount(variant, $event)" />
                                    </div>
                                    <small v-if="variant.minimum_price && variant.amount > 0 && variant.amount < variant.minimum_price" class="text-muted d-block d-md-none">
                                        {{ 'templates.page_split_fund_donations.there_is_a_minimum_donation_of' | t: symbol: '${ currencySymbol }', min_price: '${ variant.minimum_price_formatted }' }}
                                    </small>
                                </div>
                            </div>
                            <div v-if="currencies.length > 1" class="mt-3 pt-3 border-top">
                                <div class="row d-flex align-items-center no-gutters">
                                    <div class="col-12 text-right">
                                        <div class="product-currency" v-cloak>
                                            <select name="currency_code" class="form-control d-inline-block" v-model="input.currency_code">
                                                <option v-for="currency in currencies" :value="currency.code">${ currency.code } (${ currency.symbol }) - ${ currency.name }</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3 pt-3 border-top">
                                {% if site.cover_costs_ai_enabled %}
                                    <div v-if="show_cover_costs && has_fees" ref="cover_fees" class="border-bottom pb-3 mb-3 wow fadeInUp d-flex flex-column text-center text-md-left flex-md-row w-100 align-items-center justify-content-center justify-content-left {% if settings.animations %}wow fadeInUp{% endif %}" {% if settings.animations %}data-wow-delay="1s"{% endif %}>
                                        <div class="flex-1 mx-3 mt-2 mt-md-0 mb-3 mb-md-0">
                                            <div class="d-flex justify-content-start align-items-center mb-1">
                                                <h5 class="mb-0">{{ site.cover_costs_checkout_label }}</h5>
                                                <a class="ml-1" style="color:inherit" href="#" data-toggle="modal" data-target="#dcc-information-modal"><i class="fa fa-info-circle small"></i></a>
                                            </div>
                                            <p class="mb-1">{{ site.cover_costs_checkout_description }}</p>
                                        </div>
                                        <div class="ml-md-auto">
                                            <label for="inputCoverCostsType" class="sr-only"></label>
                                            <select id="inputCoverCostsType" class="form-control" name="cover_costs_type" v-model="input.cover_costs_type">
                                                <option value="most_costs">{{ 'general.forms.cover_costs.most_costs' | t: amount: '${ money(cover_costs_amounts.most_costs) }' }}</option>
                                                <option value="more_costs">{{ 'general.forms.cover_costs.more_costs' | t: amount: '${ money(cover_costs_amounts.more_costs) }' }}</option>
                                                <option value="minimum_costs">{{ 'general.forms.cover_costs.minimum_costs' | t: amount: '${ money(cover_costs_amounts.minimum_costs) }' }}</option>
                                                <option value="">{{ 'general.forms.cover_costs.no_thank_you' | t }}</option>
                                            </select>
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="row d-flex align-items-center no-gutters">
                                    <div class="col-12 col-lg-8 text-center text-lg-left my-3 my-lg-0">
                                        {% unless site.cover_costs_ai_enabled %}
                                        <div v-if="show_cover_costs && fees > 0" ref="cover_fees" class="wow fadeInUp">
                                            <div class="custom-control custom-checkbox">
                                                <input id="inputCoverFees" type="checkbox" class="custom-control-input" v-model="input.cover_fees">
                                                <label class="custom-control-label" for="inputCoverFees">
                                                    {{ site.cover_costs_checkout_description_with_amount | replace: "[$$$]", "<span class='font-weight-bold'>${ money(fees) }</span>" }}
                                                </label> <a class="ml-1" style="color:inherit" href="#" data-toggle="modal" data-target="#dcc-information-modal"><i class="fa fa-info-circle small"></i></a>
                                            </div>
                                        </div>
                                        {% endunless %}
                                    </div>
                                    <div class="col-12 col-lg-4 my-3 my-lg-0">
                                        <template v-if="is_recurring">
                                            <div class="row no-gutters font-weight-bold text-center text-lg-right">
                                                <div class="col-6">
                                                    <h4 class="cart-heading">{{ 'templates.page_split_fund_donations.total_today' | t }}</h4>
                                                </div>
                                                <div class="col-6">${ money(amount_today,true) }</div>
                                            </div>
                                            <div class="row no-gutters font-weight-bold pt-2 text-center text-lg-right">
                                                <div class="col-6"><h4 class="cart-heading">{{ 'templates.page_split_fund_donations.total_recurring' | t }}</h4></div>
                                                <div class="col-6">
                                                    <div class="mb-1">
                                                        ${ money(total_amount,true) }${ recurring_desc }
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        <div v-else class="row no-gutters font-weight-bold text-center text-lg-right">
                                            <div class="col-6">
                                                <h4 class="cart-heading">{{ 'templates.page_split_fund_donations.total' | t }}</h4>
                                            </div>
                                            <div class="col-6">${ money(total_amount,true) }</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else>
                        <div class="card mb-4 p-5 text-center {% if settings.animations %}wow fadeInUp{% endif %}" {% if settings.animations %}data-wow-delay="0.3s"{% endif %}>
                            <div class="text-muted">
                                <i class="fa fa-ban fa-3x"></i>
                                <h4 class="mt-3">{{ 'templates.page_split_fund_donations.there_are_no_funds_setup_for_donation' | t }}</h4>
                            </div>
                        </div>
                    </div>

                    <div v-if="billing_periods.length > 1 || is_recurring" class="card my-4 card-shipping {% if settings.animations %}wow fadeIn{% endif %}" {% if settings.animations %}data-wow-delay="1s"{% endif %}>
                        <div class="card-body">
                            <template v-if="billing_periods.length > 1">
                                {% assign frequency_header_text_default = 'templates.page_split_fund_donations.how_often_would_you_like_to_give' | t %}
                                <h4 class="text-left d-block mb-3">{{ page.metadata.frequency_header_text | default: frequency_header_text_default }}</h4>
                                {% if settings.page_headings_decoration == 'none' %}
                                    <hr />
                                {% endif %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group mb-3">
                                            <div class="btn-group-toggle btn-group-checked d-inline-block">
                                                <div v-for="(label, option) in billing_period_options" class="btn btn-outline-secondary mb-1 mr-1" :class="{active: (billing_period == option)}" @click="changeBillingPeriod(option)">${ label }</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div v-if="showDaySelector" class="row gutter-sm mb-1 product-recurring-day">
                                <div class="col-md-9 col-xl-6">
                                    <div class="labelify">
                                        <label for="p-recurring-day">{{ 'templates.page_split_fund_donations.payment_day' | t }}</label>
                                        <select id="p-recurring-day" name="recurring_day" v-model="input.recurring_day" class="form-control" v-validate.initial="'required'">
                                            <option v-for="day in payment_day_options" :value="day">{{ 'templates.page_split_fund_donations.day_of_month' | t: day: '${ day | ordinal }' }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div v-if="showWeekdaySelector" class="row gutter-sm mb-1 product-recurring-weekday">
                                <div class="col-md-9 col-xl-6">
                                    <div class="labelify">
                                        <label for="p-recurring-weekday">{{ 'templates.page_split_fund_donations.payment_day' | t }}</label>
                                        <select id="p-recurring-weekday" name="recurring_day_of_week" v-model="input.recurring_weekday" class="form-control" v-validate.initial="'required'">
                                            <option v-for="(day) in payment_weekday_options" :value="day.key">${ day.value }</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div v-if="showFirstPaymentSelector" class="form-check product-recurring-first-payment">
                                <input id="p-first-payment" class="form-check-input" type="checkbox" v-model="input.recurring_first_payment_today" name="recurring_with_initial_charge" value="1">
                                <label for="p-first-payment" class="form-check-label">
                                    {{ 'templates.page_split_fund_donations.make_my_first_payment_today' | t }}
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">

                            <div class="card mb-4 card-shipping {% if settings.animations %}wow fadeIn{% endif %}" {% if settings.animations %}data-wow-delay="1s"{% endif %}>
                                <div class="card-body">
                                    <h4 class="text-left d-block mb-3">{{ 'templates.page_split_fund_donations.billing' | t }}</h4>

                                    <div class="row">
                                        <div class="col-md-6">

                                            <template v-if="account_types">
                                                {% if settings.account_type_selector == 'dropdown' %}
                                                    <div class="form-group labelify">
                                                        <label for="inputAccountType">Supporter Type</label>
                                                        <select id="inputAccountType" class="form-control" name="account_type_id" v-model="input.account_type_id">
                                                            <option v-for="account_type in account_types" :value="account_type.id">${ account_type.name }</option>
                                                        </select>
                                                    </div>
                                                {% else %}
                                                    <div class="form-group">
                                                        <div class="btn-group-toggle mb-3">
                                                            <label v-for="account_type in account_types" class="btn btn-outline-dark" :class="{ active: input.account_type_id == account_type.id }">
                                                                <input type="radio" name="account_type_id" v-model="input.account_type_id" :value="account_type.id"> ${ account_type.name }
                                                            </label>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            </template>

                                            <div class="row gutter-sm">
                                                {% if site.donor_title != 'hidden' %}
                                                    <div class="col-3">
                                                        <div class="form-group labelify">
                                                            <label for="inputBillingTitle">{{ 'general.forms.title' | t }}</label>
                                                            {% if site.donor_title_options %}
                                                                <select id="inputBillingTitle" class="form-control" :class="{ 'has-errors': errors.has('pay.billing_title') }" name="billing_title" v-model="input.billing_title" {% if site.donor_title == 'required' %}v-validate.initial="'required'"{% endif %} x-autocompletetype="honorific-prefix" autocompletetype="honorific-prefix">
                                                                    <option value=""></option>
                                                                    <option v-for="title in donor_title_options" :value="title">${ title }</option>
                                                                </select>
                                                            {% else %}
                                                                <input type="text" id="inputBillingTitle" class="form-control" :class="{ 'has-errors': errors.has('pay.billing_title') }" name="billing_title" v-model="input.billing_title" {% if site.donor_title == 'required' %}v-validate.initial="'required'"{% endif %} x-autocompletetype="honorific-prefix" autocompletetype="honorific-prefix" autocorrect="off" spellcheck="off">
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <div class="col-4">
                                                    <div class="form-group labelify">
                                                        <label for="inputBillingFirstName">{{ 'general.forms.first_name' | t }}</label>
                                                        <input type="text" v-model="input.billing_first_name" id="inputBillingFirstName" class="form-control" name="billing_first_name">
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-group labelify">
                                                        <label for="inputBillingLastName">{{ 'general.forms.last_name' | t }}</label>
                                                        <input type="text" v-model="input.billing_last_name" id="inputBillingLastName" class="form-control" name="billing_last_name">
                                                    </div>
                                                </div>
                                            </div>

                                            <hr>

                                            <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.billing_email') }">
                                                <label for="inputBillingEmail"><i class="fa fa-envelope-o"></i> {{ 'general.forms.email' | t }}</label>
                                                <input id="inputBillingEmail" type="text" class="form-control" name="billing_email" v-model="input.billing_email" v-validate.initial="'required|email'" x-autocompletetype="email" autocompletetype="email" autocorrect="off" spellcheck="off" autocapitalize="off">
                                            </div>
                                            {% if page.metadata.email_optin_enabled %}
                                                <div class="form-group">
                                                    <div class="custom-control custom-checkbox">
                                                        <input id="inputEmailOptIn" type="checkbox" class="custom-control-input" v-model="input.email_opt_in">
                                                        <label class="custom-control-label" for="inputEmailOptIn">{{ settings.optin_label }}</label>
                                                    </div>
                                                </div>
                                            {% endif %}
                                            <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.billing_phone') }">
                                                <label for="inputBillingPhone"><i class="fa fa-phone"></i> {{ 'templates.page_split_fund_donations.phone' | t }}</label>
                                                <input
                                                    id="inputBillingPhone"
                                                    type="text"
                                                    class="form-control"
                                                    name="billing_phone"
                                                    v-model="input.billing_phone"
                                                    {% if page.metadata.billing_phone_required %}v-validate.initial="'required'"{% endif %}
                                                    x-autocompletetype="phone-full"
                                                    autocompletetype="tel"
                                                    autocorrect="off"
                                                    spellcheck="off"
                                                    autocapitalize="off">
                                            </div>

                                            <div v-if="account_type && account_type.is_organization" class="form-group labelify">
                                                <label for="inputBillingOrganizationName">{{ 'general.forms.organization_name' | t }}</label>
                                                <input id="inputBillingOrganizationName" type="text" class="form-control" name="billing_organization_name" v-model="input.billing_company" x-autocompletetype="organization" autocompletetype="org" autocorrect="off" spellcheck="off" autocapitalize="off">
                                            </div>

                                        </div>
                                        <div class="col-md-6">

                                            <div class="">
                                                <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.billing_address1') }">
                                                    <address-lookup-input
                                                        id="inputBillingAddress1"
                                                        name="billing_address1"
                                                        v-model="input.billing_address1"
                                                        label="{{ 'general.forms.address' | t | escape }}"
                                                        placeholder="{{ 'general.forms.address_placeholder' | t | escape }}"
                                                        @place-change="fillAddressFields"
                                                    />
                                                </div>
                                                <div class="form-group labelify">
                                                    <label for="inputBillingAddress2">{{ 'general.forms.address_2' | t }}</label>
                                                    <input id="inputBillingAddress2" type="text" class="form-control" placeholder="{{ 'general.forms.address_2_placeholder' | t }}" name="billing_address2" v-model="input.billing_address2" x-autocompletetype="address-line2" autocompletetype="address-line2" autocorrect="off" spellcheck="off" autocapitalize="off">
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-8 labelify" :class="{ 'has-errors': errors.has('pay.billing_city') }">
                                                        <label for="inputBillingCity">{{ 'general.forms.city' | t }}</label>
                                                        <input id="inputBillingCity" type="text" class="form-control" name="billing_city" v-model="input.billing_city" v-validate.initial="'required'" x-autocompletetype="city" autocompletetype="city" autocorrect="off" spellcheck="off" autocapitalize="off">
                                                    </div>
                                                    <div class="form-group col-4 labelify" :class="{ 'has-errors': errors.has('pay.billing_zip') }">
                                                        <label for="inputBillingZip">
                                                            <template v-if="input.billing_country_code == 'US'">{{ 'general.forms.zip' | t }}</template>
                                                            <template v-else>{{ 'general.forms.postal' | t }}</template>
                                                        </label>
                                                        <input id="inputBillingZip" type="text" class="form-control" name="billing_zip" v-model="input.billing_zip" v-validate.initial="'required'" x-autocompletetype="postal-code" autocompletetype="postal-code" autocorrect="off" spellcheck="off" autocapitalize="off">
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-7 labelify" :class="{ 'has-errors': errors.has('pay.billing_country_code') }">
                                                        <label for="inputBillingCountry">{{ 'general.forms.country' | t }}</label>
                                                        <select id="inputBillingCountry" class="form-control" name="billing_country_code" v-model="input.billing_country_code" v-validate.initial="'required'">
                                                            <option></option>
                                                            <option v-for="country in countries" :value="country.value">${ country.label }</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-5 labelify" :class="{ 'has-errors': errors.has('pay.billing_province_code') }">
                                                        <label for="inputBillingProvince">${ billing_province_label }</label>
                                                        <select v-if="billing_subdivisions" id="inputBillingProvince" class="form-control" name="billing_province_code" v-model="input.billing_province_code" v-validate.initial="billing_province_required">
                                                            <option></option>
                                                            <option v-for="(name, code) in billing_subdivisions" :value="code">${ name }</option>
                                                        </select>
                                                        <input v-else type="text" id="inputBillingProvince" class="form-control" name="billing_province_code" v-model="input.billing_province_code" v-validate="billing_province_required">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {% if settings.cart_create_account or show_referral_sources or show_special_notes %}
                                        <div class="row">
                                            {% if settings.cart_create_account %}
                                                <div v-if="!account" class="col-md-6 create-account-wrapper">
                                                    <h5 class="mb-3">
                                                        {{ settings.cart_create_account_label }}
                                                    </h5>
                                                    <p>{{ settings.cart_create_account_description }}</p>
                                                    <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.password') }">
                                                        <label for="inputPassword"><i class="fa fa-lock"></i> {{ 'general.forms.password' | t }}</label>
                                                        <input id="inputPassword" type="password" class="form-control" name="password" v-model="input.password" v-validate.initial="'min:6'" autocomplete="new-password">
                                                    </div>
                                                </div>
                                            {% endif %}


                                            {% if show_special_notes %}
                                                <div class="col-md-6">
                                                    {% if settings.cart_comments_label %}<h5>{{ settings.cart_comments_label }}</h5>{% endif %}
                                                    {% if settings.cart_comments_hint %}<p><small>{{ settings.cart_comments_hint }}</small></p>{% endif %}
                                                    <div class="form-group">
                                                        <textarea class="form-control form-control-sm" name="notes" rows="2" name="comments" v-model="input.comments"></textarea>
                                                    </div>
                                                </div>
                                            {% endif %}

                                            {% if show_referral_sources %}
                                                <div v-if="!account" class="{% if settings.cart_create_account and show_special_notes %}col-12{% else %}col-md-6{% endif %} mt-4">
                                                    <h5 class="mb-3">
                                                        {% if settings.referral_source_label %}{{ settings.referral_source_label }}{% else %}{{ 'general.forms.referral_source' | t }}{% endif %}
                                                    </h5>
                                                    <div class="form-group" :class="{ 'has-errors': errors.has('pay.referral_source') }">
                                                        <div class="btn-group-toggle mb-3">
                                                            <label v-for="source in referral_sources.sources" class="btn btn-outline-dark mr-1 mb-1" :class="{ active: referral_source == source }">
                                                                <input type="radio" name="referral_source" v-model="referral_source" :value="source" {% unless page.metadata.pay_page_referral_source_required == false %}v-validate.initial="'required'"{% endunless %}> ${ source }
                                                            </label><label v-if="referral_sources.allow_other" class="btn btn-outline-dark mr-1 mb-1" :class="{ active: referral_source == 'other' }">
                                                                <input type="radio" name="referral_source" v-model="referral_source" value="other"> Other
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group labelify" v-if="referral_source == 'other'" :class="{ 'has-errors': errors.has('pay.referral_source_other') }">
                                                        <label for="inputReferralSourceOther">{{ 'templates.page_split_fund_donations.other' | t }}</label>
                                                        <input id="inputReferralSourceOther"  ref="referral_source_other" type="text" class="form-control" name="referral_source_other" v-model="input.referral_source" {% unless page.metadata.pay_page_referral_source_required == false %}v-validate.initial="'required'"{% endunless %} style="max-width:200px;" maxlength="45">
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            {% if page.metadata.funds_opt_content %}
                                <div class="card mb-4">
                                    <div class="card-body pb-1">
                                        {% if page.metadata.funds_opt_content_heading %}
                                            <h4 class="text-left d-block">{{ page.metadata.funds_opt_content_heading }}</h4>
                                        {% endif %}
                                        <div class="left-left mt-3">
                                            {{ page.metadata.funds_opt_content }}
                                        </div>
                                    </div>
                                </div>
                            {% endif  %}
                            <div v-if="is_uk_address && gift_aid_enabled" class="card mb-4 {% if settings.animations %}wow fadeInUp{% endif %}" data-state="unchecked">
                                <div class="card-body">
                                    <div class="">
                                        <h4 class="text-left d-block mb-3">{{ settings.gift_aid_heading }}</h4>
                                        <p class="text-sm">{{ settings.gift_aid_description }}</p>
                                        <div class="custom-control custom-checkbox">
                                            <input id="inputGiftAid" type="checkbox" class="custom-control-input" v-model="gift_aid">
                                            <label class="custom-control-label" for="inputGiftAid">{{ settings.gift_aid_checkbox_label }}</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-4 card-payment">
                                <div class="card-body">
                                    <h4 class="text-left d-block mb-3">{{ 'templates.page_split_fund_donations.payment' | t }}</h4>

                                    <div class="row">
                                        <div class="col-12 col-lg-8 offset-lg-2">

                                            <div class="">
                                                <nav class="nav nav nav-pills nav-fill mb-3">
                                                    <template v-if="config.gateways.credit_card">
                                                        <button v-if="paysafe_checkout_available" type="button" class="btn btn-link nav-item nav-link" :class="{active: input.payment_type == 'credit_card'}" @click="input.payment_type = 'credit_card'">
                                                            <i class="fa fa-credit-card"></i> {{ 'general.forms.credit_debit' | t }}
                                                        </button>
                                                        <button v-else type="button" class="btn btn-link nav-item nav-link" :class="{active: input.payment_type == 'credit_card'}" @click="input.payment_type = 'credit_card'">
                                                            <i class="fa fa-credit-card"></i> {{ 'general.forms.credit_debit' | t }}
                                                        </button>
                                                    </template>
                                                    <button v-if="supportedPaymentType('bank_account')" type="button" class="btn btn-link nav-item nav-link" :class="{active: input.payment_type == 'bank_account'}" @click="input.payment_type = 'bank_account'">
                                                        <i class="fa fa-bank"></i> {{ 'general.forms.bank' | t }}
                                                    </button>
                                                    <button v-if="paypal_available" type="button" class="btn btn-link nav-item nav-link" :class="{active: input.payment_type == 'paypal'}" @click="input.payment_type = 'paypal'">
                                                        <i class="fa fa-paypal"></i> {{ 'general.forms.paypal' | t }}
                                                    </button>
                                                    <button v-if="account && account.payment_methods.length" type="button"  class="btn btn-link nav-item nav-link" :class="{active: input.payment_type == 'payment_method'}" @click="input.payment_type = 'payment_method'">
                                                        <i class="fa fa-user"></i> {{ 'templates.page_split_fund_donations.my_methods' | t }}
                                                    </button>
                                                </nav>
                                                <template v-if="input.payment_type == 'credit_card'">
                                                    <template v-if="paysafe_checkout_available">
                                                        <div v-if="is_onetime" class="form-group mt-2 text-center">
                                                            <div class="custom-control custom-checkbox d-inline-block">
                                                                <input type="checkbox" id="inputSavePaymentMethod" class="custom-control-input" name="save_payment_method" v-model="payment.save_payment_method">
                                                                <label class="custom-control-label" for="inputSavePaymentMethod">
                                                                    <i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.save_this_payment_information_securely' | t }}
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="text-center text-muted">
                                                            {{ 'general.actions.continue_below' | t }}<br>
                                                            <i class="fa fa-chevron-down fa-1x"></i>
                                                        </div>
                                                    </template>
                                                    <credit-card v-else>
                                                        <div class="form-group labelify payment-number-input" :class="{ 'has-errors': errors.has('pay.number') }">
                                                            <label for="inputPaymentNumber">{{ 'general.forms.credit_card_number' | t }}</label>
                                                            <payment-field field="inputPaymentNumber">
                                                                <the-mask id="inputPaymentNumber" type="tel" class="form-control monospace" maxlength="19" placeholder="0000 0000 0000 0000" mask="#### #### #### ####" name="number" v-model="payment.number" v-validate.initial="'required|credit_card'" x-autocompletetype="cc-number" autocompletetype="cc-number" autocorrect="off" spellcheck="off" autocapitalize="off"></the-mask>
                                                            </payment-field>
                                                            <div v-if="payment.number_type" class="payment-number-input__types">
                                                                <span>
                                                                    <img alt="" v-if="payment.number_type == 'american-express'" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/amex.svg">
                                                                    <img alt="" v-if="payment.number_type == 'diners-club'" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/diners.svg">
                                                                    <img alt="" v-if="payment.number_type == 'discover'"    src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/discover.svg">
                                                                    <img alt="" v-if="payment.number_type == 'jcb'"         src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/jcb.svg">
                                                                    <img alt="" v-if="payment.number_type == 'maestro'"     src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/maestro.svg">
                                                                    <img alt="" v-if="payment.number_type == 'master-card'" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/mastercard.svg">
                                                                    <img alt="" v-if="payment.number_type == 'unionpay'"    src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/unionpay.svg">
                                                                    <img alt="" v-if="payment.number_type == 'visa'"        src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/visa.svg">
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="form-row">
                                                            <div class="form-group col-6 labelify" :class="{ 'has-errors': errors.has('pay.exp') }">
                                                                <label for="inputPaymentExpiry">{{ 'general.forms.expiry' | t }}</label>
                                                                <payment-field field="inputPaymentExpiry">
                                                                    <the-mask id="inputPaymentExpiry" type="tel" class="form-control monospace" maxlength="7" placeholder="{{ 'general.forms.expiry_placeholder' | t }}" mask="## / ##" @input.native="paymentExpiry($event)" name="exp" v-model="payment.exp" v-validate.initial="'required|expiration_date'" x-autocompletetype="cc-exp" autocompletetype="cc-exp" autocorrect="off" spellcheck="off" autocapitalize="off"></the-mask>
                                                                </payment-field>
                                                            </div>
                                                            <div class="form-group col-6 labelify" :class="{ 'has-errors': errors.has('pay.cvv') }">
                                                                <label for="inputPaymentCVV">{{ 'general.forms.cvv' | t }}</label>
                                                                <payment-field field="inputPaymentCVV">
                                                                    <the-mask id="inputPaymentCVV" type="tel" class="form-control monospace" maxlength="4" placeholder="000" mask="####" name="cvv" v-model="payment.cvv" v-validate.initial="'required|cvv:' + payment.number_type" x-autocompletetype="cc-csc" autocompletetype="cc-csc" autocorrect="off" spellcheck="off" autocapitalize="off"></the-mask>
                                                                </payment-field>
                                                            </div>
                                                        </div>
                                                        <div v-if="is_onetime" class="form-group">
                                                            <div class="custom-control custom-checkbox">
                                                                <input type="checkbox" id="inputSavePaymentMethod" class="custom-control-input" name="save_payment_method" v-model="payment.save_payment_method">
                                                                <label class="custom-control-label" for="inputSavePaymentMethod">
                                                                    <i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.save_this_payment_information_securely' | t }}
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="supported-cardtypes mt-1 text-center">
                                                            <strong>We support:</strong>
                                                            <img alt="" v-if="supportedCardType('american-express')" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/amex.svg">
                                                            <img alt="" v-if="supportedCardType('diners-club')" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/diners.svg">
                                                            <img alt="" v-if="supportedCardType('discover')"    src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/discover.svg">
                                                            <img alt="" v-if="supportedCardType('jcb')"         src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/jcb.svg">
                                                            <img alt="" v-if="supportedCardType('maestro')"     src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/maestro.svg">
                                                            <img alt="" v-if="supportedCardType('master-card')" src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/mastercard.svg">
                                                            <img alt="" v-if="supportedCardType('unionpay')"    src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/unionpay.svg">
                                                            <img alt="" v-if="supportedCardType('visa')"        src="https://cdn.givecloud.co/npm/payment-icons@1.1.0/min/flat/visa.svg">
                                                        </div>
                                                    </credit-card>
                                                </template>
                                                <template v-else-if="input.payment_type == 'bank_account' && gocardless_available">
                                                    <div class="text-center text-muted">
                                                        <i class="fa fa-bank fa-4x bottom-gutter m-2"></i><br>
                                                        {{ 'general.actions.continue_below' | t }}<br>
                                                        <i class="fa fa-chevron-down fa-1x"></i>
                                                    </div>
                                                </template>
                                                <template v-else-if="input.payment_type == 'bank_account'">
                                                    <div class="form-group labelify payment-number-input" :class="{ 'has-errors': errors.has('pay.account_holder_type') }">
                                                        <label for="inputPaymentAccountHolderType">{{ 'general.forms.account_holder_type' | t }}</label>
                                                        <select id="inputPaymentAccountHolderType" class="form-control" name="account_holder_type" v-model="payment.account_holder_type" v-validate.initial="'required'" autocomplete="off">
                                                            <option></option>
                                                            <option value="personal">{{ 'general.forms.account_holder_types.individual' | t }}</option>
                                                            <option value="business">{{ 'general.forms.account_holder_types.company' | t }}</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group labelify payment-number-input" :class="{ 'has-errors': errors.has('pay.account_type') }">
                                                        <label for="inputPaymentAccountType">{{ 'general.forms.account_type' | t }}</label>
                                                        <select id="inputPaymentAccountType" class="form-control" name="account_type" v-model="payment.account_type" v-validate.initial="'required'" autocomplete="off">
                                                            <option></option>
                                                            <option value="checking">{{ 'general.forms.checking' | t }}</option>
                                                            <option value="savings">{{ 'general.forms.savings' | t }}</option>
                                                        </select>
                                                    </div>
                                                    <template v-if="payment.currency == 'CAD'">
                                                        <div class="form-row">
                                                            <div class="form-group col-6 labelify" :class="{ 'has-errors': errors.has('pay.transit_number') }">
                                                                <label for="inputPaymentTransitNumber">{{ 'general.forms.transit_no' | t }}</label>
                                                                <the-mask id="inputPaymentTransitNumber" type="tel" class="form-control monospace" maxlength="5" placeholder="00000" mask="#####" name="transit_number" v-model="payment.transit_number" v-validate.initial="'required'" autocorrect="off" spellcheck="off" autocapitalize="off"></the-mask>
                                                            </div>
                                                            <div class="form-group col-6 labelify" :class="{ 'has-errors': errors.has('pay.institution_number') }">
                                                                <label for="inputPaymentInstitutionNumber">{{ 'general.forms.institution_no' | t }}</label>
                                                                <the-mask id="inputPaymentInstitutionNumber" type="tel" class="form-control monospace" maxlength="3" placeholder="000" mask="###" name="institution_number" v-model="payment.institution_number" v-validate.initial="'required'" autocorrect="off" spellcheck="off" autocapitalize="off"></the-mask>
                                                            </div>
                                                        </div>
                                                    </template>
                                                    <template v-else>
                                                        <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.routing_number') }">
                                                            <label for="inputPaymentRoutingNumber">{{ 'general.forms.routing_no' | t }}</label>
                                                            <input id="inputPaymentRoutingNumber" type="tel" class="form-control monospace" placeholder="0000000" name="routing_number" v-model="payment.routing_number" v-validate.initial="'required'" autocorrect="off" spellcheck="off" autocapitalize="off">
                                                        </div>
                                                    </template>
                                                    <div class="form-group labelify" :class="{ 'has-errors': errors.has('pay.account_number') }">
                                                        <label for="inputPaymentAccountNumber">{{ 'general.forms.account_no' | t }}</label>
                                                        <input id="inputPaymentAccountNumber" type="tel" class="form-control monospace" minlength="4" maxlength="17" placeholder="0000000" name="account_number" v-model="payment.account_number" v-validate.initial="'required'" autocorrect="off" spellcheck="off" autocapitalize="off">
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" id="inputPaymentAchAgreeTos" class="custom-control-input" name="ach_agree_tos" v-model="payment.ach_agree_tos" v-validate.initial="'required'">
                                                            <label class="custom-control-label" for="inputPaymentAchAgreeTos">
                                                                <small class="text-muted">{{ 'templates.page_split_fund_donations.authorize_us_to_charge_account_above_for_the_amount_specified' | t }}</small>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div v-if="is_onetime" class="form-group">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" id="inputSavePaymentMethod" class="custom-control-input" name="save_payment_method" v-model="payment.save_payment_method">
                                                            <label class="custom-control-label" for="inputSavePaymentMethod">
                                                                <i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.save_this_payment_information_securely' | t }}
                                                            </label>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template v-else-if="input.payment_type == 'paypal'">
                                                    <div v-if="is_onetime" class="form-group mt-2 text-center">
                                                        <div class="custom-control custom-checkbox d-inline-block">
                                                            <input type="checkbox" id="inputSavePaymentMethod" class="custom-control-input" name="save_payment_method" v-model="payment.save_payment_method">
                                                            <label class="custom-control-label" for="inputSavePaymentMethod">
                                                                <i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.save_this_payment_information_securely' | t }}
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="text-center text-muted">
                                                        <i class="fa fa-cc-paypal fa-4x bottom-gutter"></i><br>
                                                        {{ 'general.actions.continue_below' | t }}<br>
                                                        <i class="fa fa-chevron-down fa-1x"></i>
                                                    </div>
                                                </template>
                                                <template v-else-if="account && input.payment_type == 'payment_method'">
                                                    <p><strong>{{ 'templates.page_split_fund_donations.pay_with' | t }}</strong></p>
                                                    <div v-for="method in account.payment_methods" class="custom-control custom-checkbox d-inline-block">
                                                        <input type="radio" :id="'inputSavePaymentMethod' + method.id" class="custom-control-input" name="payment_method" v-model="payment.payment_method" :value="method.id">
                                                        <label class="custom-control-label" :for="'inputSavePaymentMethod' + method.id">
                                                            <template v-if="method.card">
                                                                {{ 'templates.page_split_fund_donations.method_card_description_html' | t: brand: '${ method.card.brand }', last4: '${ method.card.last4 }', expiry_month: '${ method.card.exp_month }', expiry_year: '${ method.card.exp_year }' }}
                                                            </template>
                                                            <template v-else-if="method.bank">
                                                                {{ 'templates.page_split_fund_donations.method_bank_description' | t: name: '${ method.bank.name }', last4: '${ method.bank.last4 }' }}
                                                            </template>
                                                            <template v-else>
                                                                ${ method.name } - ${ method.account_number }
                                                            </template>
                                                        </label>
                                                    </div>
                                                </template>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="text-center ">
                                <div v-if="requires_captcha" class="mb-4 text-center">
                                    <vue-recaptcha class="d-inline-block" ref="recaptcha" sitekey="{{ site.recaptcha_site_key }}" @verify="input.recaptcha_response = $event"></vue-recaptcha>
                                </div>

                                <button v-if="is_recurring && !input.recurring_first_payment_today" class="btn btn-success btn-lg"><i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.donate_amount_recurrence_period' | t: amount: '${ money(total_amount,true) }', period: '${ input.selected_recurrence_period }' }}</button>
                                <button v-else class="btn btn-success btn-lg"><i class="fa fa-lock"></i> {{ 'templates.page_split_fund_donations.donate_amount' | t: amount: '${ money(total_amount,true) }' }}</button>

                                <div class="text-center mt-3">
                                    {% include 'gc-lock' %}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>

    </form>

    {% if page.metadata.sharing %}
        <div class="container py-4">{% sharing_links title: page_title, channels: settings.post_sharing_links_channels, hidetext: true %}</div>
    {% endif %}

    <modal id="payment-overlay" :show="isPaymentProcessing" label="{{ 'templates.page_split_fund_donations.processing' | t }}" prevent-passive-close>
        <div class="modal-content">
            <div class="modal-body text-center">
                <img class="spinner spinner-spin d-none" src="{{ 'spinner.gif' | asset_url }}" alt="">
                <img class="spinner spinner-success d-none" src="{{ 'success.gif' | asset_url }}" alt="">
            </div>
        </div>
    </modal>

    {% include 'dcc-information-modal' %}


</div>
